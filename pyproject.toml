[build-system]
requires = ["setuptools", "wheel", "setuptools-rust"]
build-backend = "setuptools.build_meta"

[tool.black]
line-length = 100
target-version = ['py37', 'py38', 'py39', 'py310', 'py311']

[tool.cibuildwheel]
manylinux-x86_64-image = "manylinux2014"
manylinux-i686-image = "manylinux2014"
skip = "pp* cp36-* *musllinux*"
test-skip = "cp310-win32 cp310-manylinux_i686 cp311-win32 cp311-manylinux_i686"
test-command = "python {project}/examples/python/stochastic_swap.py"
# We need to use pre-built versions of Numpy and Scipy in the tests; they have a
# tendency to crash if they're installed from source by `pip install`, and since
# Numpy 1.22 there are no i686 wheels, so we force pip to use older ones without
# restricting any dependencies that Numpy and Scipy might have.
before-test = "pip install --only-binary=numpy,scipy numpy scipy"
environment = 'RUSTUP_TOOLCHAIN="stable"'

[tool.cibuildwheel.linux]
before-all = "yum install -y wget && {package}/tools/install_rust.sh"
environment = 'PATH="$PATH:$HOME/.cargo/bin" CARGO_NET_GIT_FETCH_WITH_CLI="true" RUSTUP_TOOLCHAIN="stable"'


[tool.ruff]
line-length=105
select = [
  "E", # pycodestyle
  "W", # pycodestyle
  "F", # pyflakes
  "B006", # Do not use mutable data structures for argument defaults
  "B007", # unused loop control variable
  "B008", # Do not perform function call in argument defaults

  # Within an except clause, raise exceptions with `raise ... from err`
  # or `raise ... from None` to distinguish them from errors in exception handling
  "B904",

  "D419", # Docstring is empty
  "D201", # No blank lines allowed before function docstring
  "D403", # First word of the first line should be properly capitalized
  "D405", # Section name should be properly capitalized,
  "D214", # Section is over-indented
  "D416", # Section name should end with a colon
  "D210", # No whitespaces allowed surrounding docstring text
  "D211", # No blank lines allowed before class docstring
  "D208", # Docstring is over-indented
  "S506", # unsafe yaml load
  "UP027", # Replace unpacked list comprehension with a generator expression
  "UP018", # Unnecessary call to `bytes`. (Using b'' instead of bytes() is much faster)
  "UP034", # Avoid extraneous parentheses
  "UP032", # Use f-string instead of format call
  "UP031", # Use format specifiers instead of percent format
  "YTT",   # misuse of sys.version or sys.version_info
  "C4",    # flake8-comprehensions, several rules
  "DTZ003", # use of `datetime.datetime.utcnow()` is not allowed, use `datetime.datetime.now(tz=)` instead
  "ISC001", # Implicitly concatenated string literals on one line
]

target-version = "py37"

ignore = [
"E741",  # Do not use variables named 'I', 'O', or 'l'
"E731",  # Do not assign a `lambda` expression, use a `def`
"B905",  # zip-without-explicit-strict
"C901",  # mccabe function too complex
"UP015", # Unnecessary open mode parameters. For example, this removes "r".
"UP014", # convert-named-tuple-functional-to-class
]

[tool.ruff.per-file-ignores]
# The following line covers over 1300 errors
"__init__.py" = ["F401", "E402"] # imported but unused, Module level import not at top of file
"./setup.py" = ["E501"]


[tool.ruff.pydocstyle]
convention = "google"
